//- è·å–å˜é‡ post ã€comments ã€ loginUser
//- #{} æ’å…¥è¡¨è¾¾å¼ ï¼› #[] æ’å…¥pugé£æ ¼æ ‡ç­¾
//- TODO post.email è®¿é—®åˆ°é”™è¯¯çš„é‚®ç®±åœ°å€
extends layout.pug

block content
  script(src="/public/javascripts/ckeditor.js")

  .post-info.my-3.p-3.bg-body.rounded.shadow-sm
    //- è¿™é‡Œæƒ³ç”¨ä¸Šæ ‡ç­¾é¡µ
    p.fs-4.text-primary= post.title 
    p.fs-5= post.content 
    .clearfix
      span.float-end å‘å¸–äººï¼š#[a(href='/users/'+post.userId) #{post.nickname}]

  ul.comments-list.list-group.list-group-flush.my-3.p-3.bg-body.rounded.shadow-sm 
    h6.border-bottom.pb-2.mb-0 æœ€æ–°è¯„è®ºï¼š
    each comment in comments
      li.list-group-item
        div.row.mb-3
          a(href='/users/'+post.userId).col.flex-grow-0.flex-shrink-0: img(style="border:3px solid "+ comment.bdcolor width="30" height="30" src='/upload/user_avatar/'+comment.avatar).post-avatar.rounded-circle
          div.col
            small #[a(href='/users/'+comment.userId) #{comment.nickname}] å›å¤äº #{new Date(comment.timestamp).toLocaleString()}
            br
            //- span.fs-6= comment.content
            //- TODO - å¯Œæ–‡æœ¬å¦‚ä¸‹æ’å…¥ - å¯è¡Œå—ï¼Ÿ-ä¸å¯è¡Œï¼Œç›´æ¥æ”¾ä¸æ˜¯pugçš„è¯­æ³•ï¼Œè€Œæ˜¯åŸç”ŸHTMLè¯­æ³•ï¼Œ æ‰€ä»¥å°è¯•scriptæ’å…¥
            .rich-text !{comment.content}

    else 
      li.list-group-item
        span è¯¥è´´æš‚æ— è¯„è®ºï¼Œåˆ«è®©è´´ä¸»å¯‚å¯å¤ªä¹…~ ğŸ‘¶

  .post-comment-wrapper 
    if loginUser
      //- ç™»å½•å‰æä¸‹ï¼Œæäº¤çš„è¯„è®º postè¯·æ±‚(req.body.postId/content) åˆ° /allcmts
      form#post2allCmts(method='post' action='/allcmts')
        input#postId(type='hidden' name='postId' value=post.id)
        .form-floating
          #editor 
          script. 
            ClassicEditor
              .create( $( '#editor' )[0] )
              .then( editor => {
                window.editor = editor;
              } )
              .catch( error => {
                console.error( 'There was a problem initializing the editor.', error );
              } );
            window.onload = function() {
              editor.on('key',function(event){
                //- æƒ³å¼„ä¸ªç®€å•çš„å­—æ•°é™åˆ¶ï¼Œä¸è¿‡åŸºç¡€çš„ckeditorè²Œä¼¼ä¸èƒ½å¦‚é¢„æœŸå“åº”keyäº‹ä»¶
              });
            }
        button.mt-3.btn.btn-outline-primary.btn-sm(type='submit' ) è¯„è®º

    else 
      p æƒ³è¦è¯„è®ºï¼Œå³åˆ»#[a(href="/register") æ³¨å†Œ]æˆ–è€…#[a(href="/login") ç™»å½•]

  
  script(src="/public/javascripts/ajax-post2-allcmts.js") 

  //- temp - å¥—ç”¨æ¨¡æ¿ï¼Œä¸€äº›ç±»åå¯ä¼˜åŒ–ï¼ˆTODO åª’ä½“è‡ªé€‚åº”æœªå®ç° https://getbootstrap.com/docs/5.0/examples/offcanvas/ï¼‰
  //- .my-3.p-3.bg-body.rounded.shadow-sm
  //-   h6.border-bottom.pb-2.mb-0 Recent updates
  //-   each comment in comments
  //-     .d-flex.text-muted.pt-3
  //-       svg.bd-placeholder-img.flex-shrink-0.me-2.rounded(width='32' height='32' xmlns='http://www.w3.org/2000/svg' role='img' aria-label='Placeholder: 32x32' preserveAspectRatio='xMidYMid slice' focusable='false')
  //-         title Placeholder
  //-         rect(width='100%' height='100%' fill='#007bff')
  //-         text(x='50%' y='50%' fill='#007bff' dy='.3em') 32x32
  //-       p.pb-3.mb-0.small.lh-sm.border-bottom
  //-         strong.d-block.text-gray-dark @username
  //-         span= comment.content
  //-   small.d-block.text-end.mt-3
  //-     a(href='#') All updates
